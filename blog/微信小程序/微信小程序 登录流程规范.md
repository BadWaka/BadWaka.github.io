> 官方文档地址：https://mp.weixin.qq.com/debug/wxadoc/dev/api/api-login.html?t=20161122

#一. 官方登录时序图
![官方的登录时序图](http://upload-images.jianshu.io/upload_images/1828354-e0d27cfbb89026b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#二. 简单理解
这里仅按照官方推荐的规范来
###0. 前置条件
一共有三端：
- 微信小程序客户端
- 第三方服务器端（自己搭建）
- 微信服务器端


###1. 客户端获得code，并将code传给第三方服务端
微信小程序端调用wx.login，获取**登录凭证（code）**，并调用接口，将code发送到第三方客户端

###2. 第三方服务端用code换session_key和openid
小程序端将code传给第三方服务器端，第三方服务器端调用接口，用code换取session_key和openid

###3. 第三方服务端生成新的session（3rd_session）
第三方服务器端拿到请求回来的session_key和openid，先留着，不能给客户端；然后用操作系统提供的真正随机数算法生成一个新的session，叫3rd_session

###4. 第三方服务端建立对应关系，并存储
将3rd_session作为key，微信服务端返回的session_key和openid作为值，保存起来

###5. 第三方服务端将3rd_session发送到客户端
客户端只拿到3rd_session就够了，大人说话小孩别插嘴，小程序不需要知道session_key和openid

###6. 正常请求
小程序每次请求都将3rd_session放在请求头里，第三方服务端解析判断合法性，并进行正常的逻辑处理。